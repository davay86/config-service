def pomLocation = "configuration-api-parent"
def version

node {
  def img
  def releaseVersion

  stage('Checkout') {
    checkout scm
  }

  stage('Build Application') {
    sh 'mvn -B -V -U -e -f '+pomLocation+'/pom.xml clean install'
  }

  stage('Tag Release'){
    def pom = readMavenPom file: pomLocation+'/pom.xml'
    version = pom.version
    releaseVersion = version.minus("-SNAPSHOT") + "-RC"

    sh "mvn -B -V -U -e -f " + pomLocation + "/pom.xml release:clean release:prepare"

  }

  stage('Publish Image') {
      sh 'mvn -B -V -U -e -f '+pomLocation+'/pom.xml clean install -Pdocker-publish'
  }

}